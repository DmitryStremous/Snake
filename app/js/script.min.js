!function(){function e(e,t,r){this.matrix=$(e),this.rows=t,this.cols=r,this.create=function(){for(var e=0;e<this.rows*this.cols;e++)this.matrix.append($("<div class='cell'></div>"))},this.getIndex=function(e,t){return 20*(e-1)+t-1},this.getCell=function(e,t){var r=this.matrix.children().eq(this.getIndex(e,t));return r.attr("class")},this.setCell=function(e,t,r,o){var a=this.matrix.children().eq(this.getIndex(e,t));o?a.addClass(r):a.removeClass(r)},this.createFruit=function(){var e=["grape","banana","watermellon","apple"];this.fruitType=e[Math.floor(4*Math.random())],this.indexColFruit=Math.floor(20*Math.random()+1),this.indexRowFruit=Math.floor(20*Math.random()+1);var t=this.getIndex(this.indexRowFruit,this.indexColFruit);this.matrix.children().eq(t).addClass(this.fruitType)},this.removeFruit=function(){var e=this.getIndex(this.indexRowFruit,this.indexColFruit);this.matrix.children().eq(e).removeClass(this.fruitType)}}function t(e,t,r,o,a){this.alive=a,this.body=e,this.course=t,this.color=r,this.matrix=o;var s=this;this.create=function(){for(var e=0;e<s.body.length;e++)s.matrix.setCell(s.body[e].y,s.body[e].x,s.color,!0);s.matrix.setCell(s.body[0].y,s.body[0].x,"head",!0)},this.move=function(){for(s.body.unshift({y:s.body[0].y,x:s.body[0].x}),"right"==s.course&&this.alive?s.body[0].x++:"left"==s.course&&this.alive?s.body[0].x--:"down"==s.course&&this.alive?s.body[0].y++:"up"==s.course&&this.alive&&s.body[0].y--,e=1;e<s.body.length;e++)if(s.body[e].x==s.body[0].x&&s.body[e].y==s.body[0].y){this.alive=!1,$("#status h2").addClass("game_over"),$("#status h2").html("Ай-яй-яй змейка сама себя укусила...");for(var e=0;e<s.body.length;e++)s.matrix.setCell(s.body[e].y,s.body[e].x,s.color,!1);return s.matrix.setCell(s.body[1].y,s.body[1].x,"head",!1),s.matrix.setCell(s.body[0].y,s.body[0].x,"headCried",!0),!1}var t=s.body.pop();s.matrix.setCell(t.y,t.x,s.color,!1),s.matrix.setCell(s.body[0].y,s.body[0].x,s.color,!0),s.matrix.setCell(s.body[0].y,s.body[0].x,"head",!0),s.matrix.setCell(s.body[1].y,s.body[1].x,"head",!1)}}var r={UP:"38",DOWN:"40",LEFT:"37",RIGHT:"39"};window.onload=function(){var o=null,a=0,s=1,i=200;$(".btn-record").click(function(){$(".records").hasClass("show")?($(".records").animate({left:"-300px"},600),$(".btn-record").css("background-image","url('../img/records.png')")):($.get("../data/records.json","data=content",function(e){$(".results").empty();for(var t=JSON.parse(e),r="<ul>",o=0,a=t.length;a>o;o++)for(var s in t[o])r+="<li>"+s+" : "+t[o][s]+"</li>";r+="</ul>",$(".results").append(r)},"html"),$(".records").animate({left:"0px"},600),$(".btn-record").css("background-image","url('../img/records_lt.png')")),$(".records").toggleClass("show")}),$("#player_menu button").click(function(){$("#player").text($("#player_menu input").val()),$("#player_menu").addClass("hidden"),$(".darkness").fadeOut()}),$("#resetGame").click(function(){clearInterval(o),$("#matrix")&&($("#matrix").remove(),$("#status h2").empty(),$("#status h2").removeClass("game_over")),$("#startGame").removeClass("hidden"),$(this).addClass("hidden"),i=200,a=0,s=1}),$("#startGame").click(function(){function d(){function e(){a+=200,s+=1,i-=50,clearInterval(o),o=setInterval(d,i),$("#score").html(a),$("#level").html(s)}if(n.move(),n.body[0].y<1||n.body[0].y>20||n.body[0].x<1||n.body[0].x>20){n.alive=!1,$("#status h2").addClass("game_over"),$("#status h2").html("Ай-яй-яй змейка разбилась об стенку...");for(var t=0;t<n.body.length;t++)n.matrix.setCell(n.body[t].y,n.body[t].x,n.color,!1);n.matrix.setCell(n.body[0].y,n.body[0].x,"head",!1),n.matrix.setCell(n.body[1].y,n.body[1].x,"headCried",!0)}n.body[0].y==l.indexRowFruit&&n.body[0].x==l.indexColFruit&&(l.removeFruit(),n.body.push({x:0,y:0}),l.createFruit(),a+=100,$("#score").html(a)),500==a?e():1e3==a?e():1500==a?e():2e3==a&&e(),n.alive||(l.matrix.css("background-color","red"),clearInterval(o),console.log($("#player").text()+" "+$("#score").text()),$.post("../data/add.php",{name:$("#player").text(),score:$("#score").text()},function(){$.get("../data/get.php","data=content",function(e){$(".results").empty(),$(".results").append(e)},"html")},"html"),$(".records").hasClass("show")||($(".records").animate({left:"0px"},600),$(".btn-record").css("background-image","url('../img/records_lt.png')"),$(".records").toggleClass("show")))}$(this).addClass("hidden"),$("#resetGame").removeClass("hidden"),$("#score").html(a),$("#level").html(s),$("#play_ground").append("<div id='matrix'></div>");var l=new e("#matrix",20,20);l.create(),l.createFruit();var n=new t([{x:5,y:5},{x:4,y:5},{x:3,y:5}],"right","yellow",l,!0);n.create(),o=setInterval(d,i),window.onkeydown=function(e){if(!e)var e=window.event;var t;e.keyCode?t=e.keyCode:e.which&&(t=e.which),t==r.UP?n.course="up":t==r.LEFT?n.course="left":t==r.RIGHT?n.course="right":t==r.DOWN&&(n.course="down")}})}}();